<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Manejadro de Base de Datos</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="Free HTML Templates" name="keywords">
  <meta content="Free HTML Templates" name="description">

  <!-- Favicon -->
  <link href="img/favicon.ico" rel="icon">

  <!-- Google Web Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Rubik:wght@400;500;600;700&display=swap"
    rel="stylesheet">

  <!-- Icon Font Stylesheet -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Libraries Stylesheet -->
  <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
  <link href="lib/animate/animate.min.css" rel="stylesheet">

  <!-- Customized Bootstrap Stylesheet -->
  <link href="css/bootstrap.min.css" rel="stylesheet">

  <!-- Template Stylesheet -->
  <link href="css/style.css" rel="stylesheet">



  <!-- Custom Styles -->
  <style>
    /* Navbar Styles */
    .navbar {
      background-color: #343a40;
    }

    .navbar-brand {
      color: #ffffff;
      font-weight: bold;
    }

    .navbar-nav .nav-link {
      color: #ffffff;
    }

    .navbar-nav .nav-link:hover {
      color: #f8f9fa;
    }

    /* Footer Styles */
    footer {
      background-color: #343a40;
      color: #ffffff;
      padding: 20px 0;
      text-align: center;
    }
  </style>

</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark px-5 py-3 py-lg-0">
    <a class="navbar-brand" href="/index.html">Manejador de Usuarios</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="/foro.html">Foro <span class="sr-only">(current)</span></a>
        </li>
      </ul>
      <form class="form-inline my-2 my-lg-0 d-flex">
        <span id="welcomeMessage" class="nav-link" ;"></span> <!-- Mostrará el mensaje de bienvenida -->
        <span id="loggedInUser" class="nav-link" ;"></span> <!-- Mostrará el nombre del usuario -->
      </form>
      <form class="form-inline my-2 my-lg-0">
        <button class="btn btn-outline-danger my-2 my-sm-0" type="button" onclick="logout()">Cerrar Sesión</button>
      </form>
    </div>
  </nav>
  <br>
  <br>
  <br>
  <!-- Contenido principal -->
  <div class="container mt-5">
    <div class="jumbotron">
      <h1 class="display-4 text-primary">¡CerrosChan!</h1>
      <p class="lead">Bienvenido a mi foro personal pasa y registrate.</p>
      <hr class="my-4">
      <p>Esta es una página de un foro para demostración utilizando sockets.</p>

      <hr class="my-4">

      <div id="message-list"></div>
      <form onsubmit="return addMessage(this);">
        <input type="text" id="texto" placeholder="Cuéntanos algo">
        <input type="submit" value="Enviar">
      </form>


    </div>
  </div>
  <br>
  <br>
  <br>


  <!-- Inicio de sesion  -->
  <script>
    // Función para cerrar sesión
    function logout() {
      // Elimina la información de inicio de sesión almacenada en localStorage
      localStorage.removeItem('isLoggedIn');
      localStorage.removeItem('accessToken'); // Elimina el token de acceso
      localStorage.removeItem('loggedInUser'); // Elimina el nombre de usuario
      // Notificar al usuario que se cerró la sesión
      Swal.fire({
        icon: 'success',
        title: 'Sesión cerrada',
        text: 'Has cerrado sesión exitosamente.',
        allowOutsideClick: false, // Evita que el usuario cierre la alerta al hacer clic fuera de ella
        confirmButtonText: 'Iniciar sesión nuevamente'
      }).then(() => {
        // Después de cerrar sesión, redirige a la página de inicio
        window.location.href = '/index.html';
      });
    }

    // Función para mostrar la ventana emergente de inicio de sesión
    function showLoginPopup() {
      Swal.fire({
        title: 'Inicio de Sesión',
        html:
          '<input id="username" class="swal2-input" placeholder="Nombre de usuario">' +
          '<input id="password" type="password" class="swal2-input" placeholder="Contraseña">',
        focusConfirm: false,
        showCancelButton: true,
        confirmButtonText: 'Iniciar sesión',
        cancelButtonText: 'Cancelar',
        allowOutsideClick: false, // Evita que la ventana se cierre al hacer clic fuera de ella
        preConfirm: () => {
          const username = Swal.getPopup().querySelector('#username').value;
          const password = Swal.getPopup().querySelector('#password').value;
          return { username: username, password: password };
        }
      }).then((result) => {
        if (result.isConfirmed) {
          // Envía las credenciales al servidor para validar la sesión
          axios.post('/login', result.value)
            .then(function (response) {
              console.log('Login successful:', response.data);
              // Almacena el token de autenticación en localStorage
              localStorage.setItem('accessToken', response.data.token);
              // Marca al usuario como autenticado
              localStorage.setItem('isLoggedIn', true); // Almacena el estado de inicio de sesión en localStorage
              localStorage.setItem('loggedInUser', result.value.username); // Almacena el nombre de usuario en localStorage
              // Muestra un mensaje de éxito y cierra la ventana emergente
              Swal.fire({
                icon: 'success',
                title: 'Inicio de sesión exitoso',
                showConfirmButton: false,
                timer: 1500 // Cierra automáticamente la ventana emergente después de 1.5 segundos
              }).then(() => {
                // Redirige a la página de inicio después del inicio de sesión exitoso
                window.location.href = '/index.html';
              });
            })
            .catch(function (error) {
              console.error('Error durante el inicio de sesión:', error.response);
              // Muestra un mensaje de error si el inicio de sesión falla
              Swal.fire({
                icon: 'error',
                title: 'Error de inicio de sesión',
                text: 'Nombre de usuario o contraseña incorrectos. Por favor, inténtalo de nuevo.'
              }).then(() => {
                // Vuelve a mostrar la ventana emergente de inicio de sesión
                showLoginPopup();
              });
            });
        } else if (result.dismiss === Swal.DismissReason.cancel) {
          // Si el usuario cancela el inicio de sesión, redirige a la página de inicio
          window.location.href = '/index.html';
        }
      });
    }

    // Función para verificar si el usuario ha iniciado sesión
    function checkLoginStatus() {
      const accessToken = localStorage.getItem('accessToken');
      if (!accessToken) {
        showLoginPopup(); // Si el usuario no ha iniciado sesión, muestra la ventana emergente de inicio de sesión
      } else {
        // Si el usuario ha iniciado sesión, mostrar su nombre en el navbar
        const loggedInUser = localStorage.getItem('loggedInUser');
        document.getElementById('loggedInUser').textContent = `Bienvenido, ${loggedInUser}`;
      }
    }

    // Función para mostrar la ventana emergente de inicio de sesión al cargar la página
    window.addEventListener('DOMContentLoaded', function () {
      checkLoginStatus(); // Verifica el estado de inicio de sesión cuando se carga la página
    });
  </script>

  <!-- Agregar el mensaje de bienvenida -->
  <script>
    // Obtener el elemento del DOM donde se mostrará el mensaje de bienvenida
    var welcomeMessageElement = document.getElementById("welcomeMessage");

    // Agregar el mensaje de bienvenida
    welcomeMessageElement.textContent = "Bienvenido";
  </script>


  <!-- Footer Start -->
  <div class="container-fluid bg-dark text-light mt-5 wow fadeInUp" data-wow-delay="0.1s">
    <div class="container">
      <div class="row gx-5">
        <div class="col-lg-4 col-md-6 footer-about">
          <div class="d-flex flex-column align-items-center justify-content-center text-center bg-primary p-3">
            <a href="#" class="navbar-brand">
              <h3 class="m-0 text-white"><i class="fa fa-user-tie me-2"></i>Descripción</h3>
            </a>
            <p class="mt-2 mb-3">"Manejador de Usuarios" es una aplicación web para gestionar usuarios de manera
              eficiente.</p>
          </div>
        </div>
        <div class="col-lg-8 col-md-6">
          <div class="row gx-5">
            <div class="col-lg-6 col-md-6 pt-3">
              <div class="section-title  position-relative section-title-sm pb-2 mb-3">
                <h4 class="text-light mb-0">Contacto</h4>
              </div>
              <div class="d-flex flex-column mb-2">
                <p class="mb-1"><i class="bi bi-geo-alt text-primary me-1"></i>Delicias, Chihuahua, México.</p>
                <p class="mb-1"><i class="bi bi-envelope-open text-primary me-1"></i>daniel192412012@gmail.com</p>
                <p class="mb-1"><i class="bi bi-telephone text-primary me-1"></i>+052-639-159-97-45</p>
              </div>
            </div>
            <div class="col-lg-6 col-md-6 pt-3">
              <div class="section-title position-relative section-title-sm pb-2 mb-3">
                <h4 class="text-light mb-0">Enlaces</h4>
              </div>
              <div class="link-animated d-flex flex-column justify-content-start">
                <a class="text-light mb-1" href="index.html"><i
                    class="bi bi-arrow-right text-primary me-1"></i>Inicio</a>
                <a class="text-light mb-1" href="foro.html"><i class="bi bi-arrow-right text-primary me-1"></i>Foro</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="container-fluid text-white" style="background: #061429;">
    <div class="container text-center">
      <div class="row justify-content-end">
        <div class="col-lg-8 col-md-6">
          <div class="d-flex align-items-center justify-content-center" style="height: 50px;">
            <p class="mb-0">&copy; <a class="text-white border-bottom" href="#">DHO</a>. Todos los derechos reservados ©
              Daniel Hernández Company.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Footer End -->

  <!-- JavaScript Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="lib/wow/wow.min.js"></script>
  <script src="lib/easing/easing.min.js"></script>
  <script src="lib/waypoints/waypoints.min.js"></script>
  <script src="lib/counterup/counterup.min.js"></script>
  <script src="lib/owlcarousel/owl.carousel.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
  <script src="mainClient.js"></script>
  <!-- JavaScript Libraries End-->
</body>

</html>